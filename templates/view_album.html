{% extends "base.html" %}
{% block title %}{{ album_name }} - Album{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

{% if logged_in %}
<form method="POST" action="{{ url_for('delete_images') }}" onsubmit="return confirm('Are you sure to delete selected images?');">
{% endif %}

<style>
/* ===== 背景虚化 ===== */
.album-bg {
    position: fixed;
    inset: 0;
    z-index: -1;
    background: {% if images|length > 0 %}url('{{ images[0].secure_url }}'){% else %}linear-gradient(180deg, #efefef 0%, #e7e7e7 100%){% endif %} center/cover no-repeat;
    filter: blur(25px) brightness(0.6);
}

/* ===== 标题 ===== */
.album-header {
    text-align: center;
    margin: 30px 0 20px;
    font-size: 2.2em;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 10px rgba(0,0,0,0.6);
}

/* ===== 横向滑动画廊 ===== */
.album-gallery {
    display: flex;
    overflow-x: auto;
    gap: 12px;
    padding: 20px;
    scroll-behavior: smooth;
}

.album-gallery::-webkit-scrollbar {
    height: 10px;
}
.album-gallery::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.4);
    border-radius: 5px;
}
.album-gallery::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.2);
}

/* 每张图片卡片 */
.album-gallery a {
    flex: 0 0 auto;
    width: 14%; /* 一行大约6-7张 */
    min-width: 160px;
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.album-gallery a img {
    width: 100%;
    height: auto;
    display: block;
    border-radius: inherit;
}

.album-gallery a:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
}

/* 管理员 checkbox */
.album-gallery input[type="checkbox"] {
    position: absolute;
    top: 8px;
    left: 8px;
    z-index: 10;
    width: 18px;
    height: 18px;
    accent-color: #007bff;
}

/* 响应式调整 */
@media (max-width: 1024px) {
    .album-gallery a { width: 18%; min-width: 140px; }
}
@media (max-width: 768px) {
    .album-gallery a { width: 28%; min-width: 120px; }
}
@media (max-width: 480px) {
    .album-gallery a { width: 45%; min-width: 100px; }
}
</style>

<div class="album-bg"></div>

<header class="album-header">{{ album_name }} Album</header>

<div class="album-gallery">
    {% for img in images %}
    <a href="{{ img.secure_url }}" class="glightbox" data-gallery="album-{{ album_name }}">
        {% if logged_in %}
        <input type="checkbox" name="public_ids" value="{{ img.public_id }}">
        {% endif %}
        <img src="{{ img.secure_url }}" alt="Photo in {{ album_name }}" loading="lazy">
    </a>
    {% endfor %}
</div>

{% if logged_in %}
  <input type="hidden" name="album_name" value="{{ album_name }}">
  <div style="text-align: right; margin: 10px 18px 40px 18px;">
    <button type="submit" style="padding: 8px 14px; border-radius:6px; background:#d9534f; color:#fff; border:none;">
      Delete Selected Images
    </button>
  </div>
</form>
{% endif %}

<script>
const lightbox = GLightbox({
    selector: '.glightbox',
    loop: true,
    touchNavigation: true,
    keyboardNavigation: true,
    closeOnOutsideClick: true
});
</script>
{% endblock %}
