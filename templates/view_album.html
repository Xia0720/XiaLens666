{% extends "base.html" %}
{% block title %}{{ album_name }} - Album{% endblock %}
{% block body_class %}album-page{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

<style>
html, body { height: 100%; margin: 0; padding: 0; }

/* 移除渐变背景，完全交给虚化背景 */
html, body { background: none !important; }

/* ========== 全屏虚化背景 ========== */
body.album-page::before {
  content: "";
  position: fixed;
  inset: 0;
  background-image: url('{{ background_url if background_url else "https://res.cloudinary.com/dpr0pl2tf/image/upload/v1756329504/pexels-alex-andrews-271121-1983038_dbwaac.jpg" }}');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  filter: blur(8px) brightness(0.85);
  z-index: -2;
  pointer-events: none;
}

.album-bg-fallback {
  position: fixed;
  inset: 0;
  background-image: url('{{ background_fallback_url if background_fallback_url else "https://res.cloudinary.com/dpr0pl2tf/image/upload/v1754343393/pexels-caio-69969_aq5kzz.jpg" }}');
  background-size: cover;
  background-position: center;
  filter: blur(8px) brightness(0.82);
  z-index: -3;
  pointer-events: none;
}

/* ---------- 内容容器 ---------- */
.album-content {
  position: relative;
  z-index: 5;
  width: 100%;
  padding: 40px 20px;
  box-sizing: border-box;
  min-height: 100vh; /* 避免高度不够时露出白底 */
}

/* 页面标题 */
.album-content h1 {
  text-align: center;
  font-size: 2.2rem;
  color: #fff;
  text-shadow: 0 2px 6px rgba(0,0,0,0.6);
  margin-bottom: 36px;
}

/* ---------- 横向滚动行 ---------- */
.album-row {
  display: flex;
  gap: 20px;
  overflow-x: auto;
  padding: 0 20px;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  margin-bottom: 36px;
  justify-content: start;
}

/* 滚动条渐变美化 */
.album-row::-webkit-scrollbar { height: 12px; }
.album-row::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 6px;
}
.album-row::-webkit-scrollbar-thumb {
  border-radius: 6px;
  background: linear-gradient(90deg, #ff9a9e, #fad0c4, #a1c4fd);
}
.album-row::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(90deg, #a1c4fd, #ff9a9e, #fad0c4);
}

/* ---------- 单张图片 ---------- */
.album-item {
  flex: 0 0 auto;
  width: 260px;   /* 再调大 */
  height: 200px;  /* 再调大 */
  border-radius: 14px;
  overflow: hidden;
  box-shadow: 0 6px 18px rgba(0,0,0,0.15);
  position: relative;
  scroll-snap-align: center;
  background: rgba(255,255,255,0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.album-item:hover {
  transform: scale(1.06);
  box-shadow: 0 12px 28px rgba(0,0,0,0.2);
}

.album-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* 管理员 checkbox */
.album-item input[type="checkbox"] {
  position: absolute;
  top: 12px;
  left: 12px;
  z-index: 10;
  width: 20px;
  height: 20px;
  accent-color: #007bff;
}

/* 响应式调整 */
@media (max-width: 1024px) { .album-item { width: 260px; height: 200px; } }
@media (max-width: 768px)  { .album-item { width: 200px; height: 150px; } }
@media (max-width: 480px)  { .album-item { width: 140px; height: 110px; } }
</style>

<div class="album-bg-fallback" aria-hidden="true"></div>

<div class="album-content">
  <h1>{{ album_name }} Album</h1>

  {% if logged_in %}
  <form method="POST" action="{{ url_for('delete_images') }}" onsubmit="return confirm('Are you sure to delete selected images?');">
  {% endif %}

  {% set row_size = 10 %}
  {% for i in range(0, images|length, row_size) %}
    <div class="album-row">
      {% for img in images[i:i+row_size] %}
      <div class="album-item">
        {% if logged_in %}
          <input type="checkbox" name="public_ids" value="{{ img.public_id }}">
        {% endif %}
        <a href="{{ img.secure_url }}" class="glightbox" data-gallery="album-{{ album_name }}">
          <img src="{{ img.secure_url }}" alt="Photo" loading="lazy">
        </a>
      </div>
      {% endfor %}
    </div>
  {% endfor %}

  {% if logged_in %}
    <input type="hidden" name="album_name" value="{{ album_name }}">
    <div style="text-align: right; margin: 20px 18px 40px 18px;">
      <button type="submit" style="padding: 8px 14px; border-radius:6px; background:#d9534f; color:#fff; border:none;">
        Delete Selected Images
      </button>
    </div>
  {% endif %}
</div>

<script>
const lightbox = GLightbox({
  selector: '.glightbox',
  loop: true,
  touchNavigation: true,
  keyboardNavigation: true,
  closeOnOutsideClick: true
});
</script>
{% endblock %}
