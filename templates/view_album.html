{% extends "base.html" %}
{% block title %}{{ album_name }} - Album{% endblock %}
{% block body_class %}album-page{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>

<style>
html, body { height: 100%; margin: 0; padding: 0; }

/* ç§»é™¤æ¸å˜èƒŒæ™¯ï¼Œå®Œå…¨äº¤ç»™è™šåŒ–èƒŒæ™¯ */
html, body { background: none !important; }

/* ========== å…¨å±è™šåŒ–èƒŒæ™¯ ========== */
body.album-page::before {
  content: "";
  position: fixed;
  inset: 0;
  background-image: url('{{ background_url if background_url else "https://res.cloudinary.com/dqmez4f6x/image/upload/v1758647656/pexels-alex-andrews-271121-1983038_dr0gki.jpg" }}');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  filter: blur(8px) brightness(0.85);
  z-index: -2;
  pointer-events: none;
}

.album-bg-fallback {
  position: fixed;
  inset: 0;
  background-image: url('{{ background_fallback_url if background_fallback_url else "https://res.cloudinary.com/dqmez4f6x/image/upload/v1758647656/pexels-alex-andrews-271121-1983038_dr0gki.jpg" }}');
  background-size: cover;
  background-position: center;
  filter: blur(8px) brightness(0.82);
  z-index: -3;
  pointer-events: none;
}

/* ---------- å†…å®¹å®¹å™¨ ---------- */
.album-content {
  position: relative;
  z-index: 5;
  width: 100%;
  padding: 40px 20px;
  box-sizing: border-box;
  min-height: 100vh;
}

/* é¡µé¢æ ‡é¢˜ */
.album-content h1 {
  text-align: center;
  font-size: 1.8rem;
  color: #000;
  font-weight: 900;
  text-shadow: 
    -1px -1px 0 #fff,
     1px -1px 0 #fff,
    -1px  1px 0 #fff,
     1px  1px 0 #fff,
     0  2px 5px rgba(0,0,0,0.5);
  margin-bottom: 8px;
}

/* Drive CTA */
.drive-cta {
  display:inline-block;
  margin: 8px auto 28px;
  text-decoration: none;
  background:#f1f8ff;
  border:1px solid #cfe6ff;
  color:#174ea6;
  padding:8px 12px;
  border-radius:8px;
  font-weight:600;
}

/* ---------- æ¨ªå‘æ»šåŠ¨è¡Œ ---------- */
.album-row {
  display: flex;
  gap: 20px;
  overflow-x: auto;
  padding: 0 20px;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  margin-bottom: 36px;
  justify-content: start;
}

/* æ»šåŠ¨æ¡æ¸å˜ç¾åŒ– */
.album-row::-webkit-scrollbar { height: 12px; }
.album-row::-webkit-scrollbar-track {
  background: rgba(255,255,255,0.05);
  border-radius: 6px;
}
.album-row::-webkit-scrollbar-thumb {
  border-radius: 6px;
  background: linear-gradient(90deg, #434343, #000000, #ffd700);
}
.album-row::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(90deg, #ffd700, #000000, #434343);
}

/* ---------- å•å¼ å›¾ç‰‡ ---------- */
.album-item {
  flex: 0 0 auto;
  width: 260px;
  height: 200px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 6px 18px rgba(0,0,0,0.15);
  position: relative;
  scroll-snap-align: center;
  background: rgba(255,255,255,0.05);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.album-item:hover {
  transform: scale(1.06);
  box-shadow: 0 12px 28px rgba(0,0,0,0.2);
}

.album-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* ç®¡ç†å‘˜ checkbox */
.album-item input[type="checkbox"] {
  position: absolute;
  top: 12px;
  left: 12px;
  z-index: 10;
  width: 20px;
  height: 20px;
  accent-color: #007bff;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 1024px) { .album-item { width: 260px; height: 200px; } }
@media (max-width: 768px)  { .album-item { width: 200px; height: 150px; } }
@media (max-width: 480px)  { .album-item { width: 140px; height: 110px; } }

.empty-note {
  text-align:center;
  color:#666;
  padding:36px 12px;
  background:#fffdf7;
  border-radius:8px;
  margin-top:18px;
}
</style>

<div class="album-bg-fallback" aria-hidden="true"></div>
<div class="album-content">
  <h1>{{ album_name }} Album</h1>

  {% if drive_link %}
    <div style="text-align:center; margin-top:20px;">
      <a href="{{ drive_link }}" target="_blank" class="drive-cta">
        ğŸ“¸ View Full Album
      </a>
    </div>
  {% endif %}

  {% if logged_in %}
  <form method="POST" action="{{ url_for('delete_images') }}" 
        onsubmit="return confirm('Are you sure to delete selected images?');">
  {% endif %}

  {% set row_size = 10 %}
  {% if photos and photos|length > 0 %}
    {% for i in range(0, photos|length, row_size) %}
      <div class="album-row">
        {% for photo in photos[i:i+row_size] %}
        <div class="album-item">
          {% if logged_in %}
            <input type="checkbox" name="to_delete" value="{{ photo['url'] }}">
          {% endif %}
          <a href="{{ photo['url'] }}" class="glightbox" data-gallery="album-{{ album_name }}">
            <!-- âœ… ä¿®å¤: æ”¹ä¸º photo['url']ï¼Œç¡®ä¿ä» dict æ­£ç¡®å–å€¼ -->
            <img src="{{ photo['url'] }}" alt="Photo" loading="lazy" onerror="this.src='{{ url_for('static', filename='images/default_cover.jpg') }}'">
          </a>
        </div>
        {% endfor %}
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-note">
      è¿™ä¸ªç›¸å†Œä¸­è¿˜æ²¡æœ‰ï¼ˆæ–°çš„ï¼‰ç…§ç‰‡å¯ä»¥æ˜¾ç¤ºã€‚
      {% if drive_link %}
        <div style="margin-top:10px;">
          æ—§ç…§ç‰‡å¯é€šè¿‡ <a href="{{ drive_link }}" target="_blank">Google Driveï¼ˆæ—§ç…§ç‰‡ï¼‰</a> æŸ¥çœ‹ã€‚
        </div>
      {% endif %}
    </div>
  {% endif %}

  {% if logged_in %}
    <input type="hidden" name="album_name" value="{{ album_name }}">
    <div style="text-align: right; margin: 20px 18px 40px 18px;">
      <button type="submit" style="padding: 8px 14px; border-radius:6px; background:#d9534f; color:#fff; border:none;">
        Delete Selected Images
      </button>
    </div>
  </form>
  {% endif %}
</div>

<script>
const lightbox = GLightbox({
  selector: '.glightbox',
  loop: true,
  touchNavigation: true,
  keyboardNavigation: true,
  closeOnOutsideClick: true
});
</script>
{% endblock %}
