{% extends "base.html" %}
{% block title %}Albums - XiaCapture{% endblock %}
{% block content %}
<h1 style="text-align:center; margin-top:20px;">Albums</h1>

<div class="album-grid">
  {% for album in albums %}
    <div class="album-item">
      <a href="{{ url_for('view_album', album_name=album.name) }}">
        {% if album.cover %}
          <img src="{{ album.cover }}" alt="{{ album.name }}">
        {% else %}
          <div style="width:200px; height:200px; background:#ccc; border-radius:8px; display:flex; align-items:center; justify-content:center;">
            No cover
          </div>
        {% endif %}
        <p>{{ album.name }}</p>
      </a>

      {% if logged_in %}
      <!-- 重命名按钮 -->
      <button onclick="renameAlbum('{{ album.name }}')">Rename</button>
      {% endif %}
    </div>
  {% endfor %}
</div>

<script>
function renameAlbum(oldName) {
    console.log("renameAlbum clicked for:", oldName);
    let newName = prompt("Enter new album name:", oldName);
    if (!newName || newName.trim() === oldName.trim()) {
        alert("New album name must be different!");
        return;
    }

    fetch(`/rename_album/${encodeURIComponent(oldName)}`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({new_name: newName.trim()})
    })
    .then(res => res.json())
    .then(data => {
        console.log("Server response:", data);
        if(data.success){
            location.reload();
        } else {
            alert("Rename failed: " + (data.error || "Unknown error"));
        }
    })
    .catch(err => {
        alert("Rename failed: " + err);
    });
}
</script>

{% endblock %}












