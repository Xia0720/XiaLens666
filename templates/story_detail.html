{% extends "base.html" %}
{% block title %}Story Detail - XiaCapture{% endblock %}

{% block content %}
<div class="story-detail">
    <h1>Story Detail</h1>

    <div class="back-button">
        <a href="{{ url_for('story_list') }}" class="btn-back">← Back story</a>
    </div>

    <p class="story-text">{{ story.text|safe }}</p>

    {% if story.images %}
    <div class="story-images">
        {% for img in story.images %}
            <a href="{{ img.image_url }}" data-lightbox="story-{{ story.id }}" data-title="{{ story.text|truncate(100)|safe }}">
                <img src="{{ img.image_url | replace('/upload/', '/upload/w_400,h_400,c_fill,f_auto,q_auto/') }}" 
                     alt="Story Image" loading="lazy">
            </a>
        {% endfor %}
    </div>
    {% else %}
        <p style="text-align:center;">暂无图片</p>
    {% endif %}

    <div class="story-meta">
        <span class="created-at">{{ story.created_at.strftime('%Y-%m-%d %H:%M') if story.created_at else '' }}</span>
        {% if logged_in %}
        <div class="story-actions">
            <a href="{{ url_for('edit_story', story_id=story.id) }}" class="edit-btn">Edit</a>
            <form method="POST" action="{{ url_for('delete_story', story_id=story.id) }}" class="inline-delete" onsubmit="return confirm('Are you sure you want to delete this story?');">
                <button type="submit" class="delete-btn">Delete</button>
            </form>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // 确保 Lightbox2 已经加载
    if (window.lightbox) {
        lightbox.option({
          'resizeDuration': 200,
          'wrapAround': true,  // 左右切换
          'fadeDuration': 200,
          'imageFadeDuration': 200
        });
    }
</script>
{% endblock %}
