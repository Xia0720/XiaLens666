{% extends "base.html" %}
{% block title %}Story Detail - XiaCapture{% endblock %}

{% block content %}
<div class="story-detail">
    <h1>Story Detail</h1>

    <!-- 返回按钮 -->
    <div class="back-button">
        <a href="{{ url_for('story_list') }}" class="btn-back">← Back to story</a>
    </div>

    <!-- 图片展示 -->
    {% if story.images %}
    <div class="story-images">
        {% for img in story.images %}
            <a href="{{ img.image_url }}" class="glightbox" data-gallery="story-{{ story.id }}">
                <img src="{{ img.image_url | replace('/upload/', '/upload/w_400,h_400,c_fill,f_auto,q_auto/') }}"
                     alt="Story Image"
                     loading="lazy">
            </a>
        {% endfor %}
    </div>
    {% endif %}

    <!-- 文字内容 -->
    <p class="story-text">{{ story.text|safe }}</p>

    <!-- 元信息和编辑删除按钮 -->
    <div class="story-meta">
        <span class="created-at">{{ story.created_at.strftime('%Y-%m-%d %H:%M') if story.created_at else '' }}</span>
        {% if logged_in %}
            <div class="story-actions">
                <a href="{{ url_for('edit_story', story_id=story.id) }}" class="edit-btn">Edit</a>
                <form method="POST" action="{{ url_for('delete_story', story_id=story.id) }}" class="inline-delete" onsubmit="return confirm('Are you sure you want to delete this story?');">
                    <button type="submit" class="delete-btn">Delete</button>
                </form>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // 初始化 GLightbox
  const lightbox = GLightbox({
    selector: '.glightbox',
    loop: true,
    touchNavigation: true,
  });
</script>
{% endblock %}
