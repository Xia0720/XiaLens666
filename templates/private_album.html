{% extends "base.html" %}

{% block title %}Private Album Space{% endblock %}

{% block content %}
<h1 style="text-align:center; margin-top:20px;">Private Album Space</h1>

<!-- 上传区域 -->
<div style="max-width: 600px; margin: 20px auto; padding: 10px; border: 1px solid #ccc; border-radius: 8px;">
  <form id="uploadForm">
    <label>选择相册：</label>
    <select name="album" id="albumSelect">
      {% for album in album_names %}
        <option value="{{ album }}" {% if album==last_album %}selected{% endif %}>{{ album }}</option>
      {% endfor %}
      <option value="new">新建相册</option>
    </select>
    <br><br>
    <input type="text" name="new_album" id="newAlbum" placeholder="新相册名（仅选择新建时填写）">
    <br><br>
    <input type="file" name="photo" id="photoInput" multiple>
    <br><br>
    <button type="submit">上传照片</button>
  </form>
  <div id="uploadStatus" style="margin-top:10px;"></div>
</div>

<!-- 相册展示 -->
<div class="album-grid">
  {% for album in album_names %}
    <div class="album-item">
      <a href="{{ url_for('view_private_album', album_name=album) }}">{{ album }}</a>
    </div>
  {% endfor %}
</div>

<style>
.album-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin-top: 20px;
}
.album-item {
  width: 150px;
  height: 150px;
  background: #f5f5f5;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 8px;
  font-weight: bold;
  text-align: center;
  cursor: pointer;
}
.album-item a {
  text-decoration: none;
  color: #333;
}
</style>

<script>
const uploadForm = document.getElementById("uploadForm");
const uploadStatus = document.getElementById("uploadStatus");

uploadForm.addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(uploadForm);
  uploadStatus.textContent = "上传中...";

  try {
    const res = await fetch("{{ url_for('upload_private') }}", {
      method: "POST",
      body: formData,
    });
    const data = await res.json();

    if (data.success) {
      uploadStatus.textContent = "上传成功！";
      // 上传成功后刷新页面显示新相册
      window.location.reload();
    } else {
      uploadStatus.textContent = "上传失败: " + data.error;
    }
  } catch (err) {
    uploadStatus.textContent = "请求出错: " + err;
  }
});
</script>
{% endblock %}
